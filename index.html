<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags always come first -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta http-equiv="x-ua-compatible" content="ie=edge">

		<link rel="stylesheet" href="https://bootswatch.com/cosmo/bootstrap.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/handsontable/0.26.1/handsontable.full.min.css">
		<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handsontable/0.26.1/handsontable.full.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>
	</head>

	<body>
		<ul class="nav nav-tabs">
			<li class="active"><a href="#appointment" data-toggle="tab" aria-expanded="true">Appointment</a></li>
			<li class=""><a href="#join-us" data-toggle="tab" aria-expanded="false">Complimentary Dinner</a></li>
		</ul>
		<div id="myTabContent" class="tab-content">
			<div class="tab-pane fade active in" id="appointment">
				Choose reply email
				<select id="reply">
					<option></option>
					<option>hayden@s-nfg.com</option>
					<option>ethan@s-nfg.com</option>
					<option>rory@s-nfg.com</option>
					<option>Madison@s-nfg.com</option>
					<option>brody@s-nfg.com</option>
				</select>
				<p>Copy and paste the data or import a .csv</p>
				<p>The imported .csv needs to have the same column headers as the table (First Name, Last Name, Location, School District, Email, URL)</p>
				<input type="file" id="file">
				<div id="csv"></div>
				<div class="row"><button id="csv-generate">Generate URLs</button></div>
			</div>
			<div class="tab-pane fade" id="join-us">
				<div class="well bs-component">
					<form id="event-details" class="form-horizontal">
						<fieldset>
							<div class="form-group">
								<label class="col-lg-2 control-label">Address</label>
								<div class="col-lg-10">
									<input name="address" type="text" class="form-control" placeholder="Address">
								</div>
							</div>
							<div class="form-group">
								<label class="col-lg-2 control-label">Address Line 2</label>
								<div class="col-lg-10">
									<input name="address2" type="text" class="form-control" placeholder="Address Line 2">
								</div>
							</div>
							<div class="form-group">
								<label class="col-lg-2 control-label">City</label>
								<div class="col-lg-10">
									<input name="city" type="text" class="form-control" placeholder="City">
								</div>
							</div>
							<div class="form-group">
								<label class="col-lg-2 control-label">State</label>
								<div class="col-lg-10">
									<input name="state" type="text" class="form-control" placeholder="Texas">
								</div>
							</div>
							<div class="form-group">
								<label class="col-lg-2 control-label">ZIP</label>
								<div class="col-lg-10">
									<input name="zip" type="text" class="form-control" placeholder="ZIP">
								</div>
							</div>
							<div class="form-group">
								<label class="col-lg-2 control-label">Date</label>
								<div class="col-lg-10">
									<input name="date" type="text" class="form-control" placeholder="MM/DD/YYYY">
								</div>
							</div>
							<div class="form-group">
								<label class="col-lg-2 control-label">Time</label>
								<div class="col-lg-10">
									<input name="time" type="text" class="form-control" placeholder="07:00 PM">
								</div>
							</div>
						</fieldset>
					</form>
				</div>
				<p>Copy and paste the data or import a .csv</p>
				<p>The imported .csv needs to have the same column headers as the table ('First Name', 'Last Name', 'Email')</p>
				<input type="file" id="file2">
				<div id="csv2"></div>
				<button id="csv-generate2">Generate URLs</button>
			</div>
		</div>
	</body>

	<script>
		var colHeaders = ['First Name', 'Last Name', 'Location', 'School District', 'Email', 'URL'];
		var paramNames = ['first', 'last', 'district', 'location', 'email'];
		var colHeaders2 = ['First Name', 'Last Name', 'Email', 'URL'];
		var paramNames2 = ['first', 'last', 'email'];
		var csvTable = new Handsontable(document.getElementById('csv'), {
			data: [colHeaders],
			colHeaders: colHeaders,
			rowHeaders: true,
			minSpareRows: 1,
			copyRowsLimit: 10000
		});
		var csvTable2 = new Handsontable(document.getElementById('csv2'), {
			data: [colHeaders2],
			colHeaders: colHeaders2,
			rowHeaders: true,
			minSpareRows: 1,
			copyRowsLimit: 10000
		});

		$(document).ready(function() {
			$('#csv-generate').click(function() {
				data = csvTable.getData();
				for (var i = 0; i < data.length; i++) {
					var row = data[i];
					var url = 'http://www.sn-fg.com/?';
					var isFirst = true;
					for (var j = 0; j < row.length - 1; j++) {
						if (isFirst && row[j]) {
							// no & on first parameter
							url += paramNames[j] + '=' + row[j];
							isFirst = false;
						} else if (row[j]) {
							url += '&' + paramNames[j] + '=' + row[j];
						}
					}

					// if reply email is select
					if ($('#reply').val() != '') {
						url += '&reply=' + $('#reply').val();
					}

					// last element, generate URL for row
					if (j == row.length - 1) {
						csvTable.setDataAtCell(i, j, url);
					}
				}
				csvTable.render();
			});

			$('#file').change(function(e) {
				var file = e.target.files[0];
				var papa = Papa.parse(file, {
					header: false,
					dynamicTyping: true,
					complete: function(results) {
						csvTable.destroy();
						csvTable = new Handsontable(document.getElementById('csv'), {
							data: results.data,
							colHeaders: colHeaders,
							rowHeaders: true
						});
					}
				});
			})

			$('#csv-generate2').click(function() {
				data = csvTable2.getData();
				for (var i = 0; i < data.length; i++) {
					var row = data[i];
					var url = 'http://www.sn-fg.com/join-us?';
					var isFirst = true;
					for (var j = 0; j < row.length - 1; j++) {
						if (isFirst && row[j]) {
							// no & on first parameter
							url += paramNames2[j] + '=' + row[j];
							isFirst = false;
						} else if (row[j]) {
							url += '&' + paramNames2[j] + '=' + row[j];
						}
					}

					// add form fields to url
					$.each($('#event-details').serializeArray(), function(i, field) {
						url += '&' + field.name + '=' + field.value;
					});

					// last element, generate URL for row
					if (j == row.length - 1) {
						csvTable2.setDataAtCell(i, j, url);
					}
				}
				csvTable2.render();
			});

			$('#file2').change(function(e) {
				var file = e.target.files[0];
				var papa = Papa.parse(file, {
					header: false,
					dynamicTyping: true,
					complete: function(results) {
						csvTable2.destroy();
						csvTable2 = new Handsontable(document.getElementById('csv2'), {
							data: results.data,
							colHeaders: colHeaders2,
							rowHeaders: true
						});
					}
				});
			})
		});
	</script>

</html>